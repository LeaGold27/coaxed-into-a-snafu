Namespace.Register("Microsoft.Online.BOX.JS");Microsoft.Online.BOX.JS.XmlHttpRequestService=new function(){this.GetVerb="GET";this.PostVerb="POST";this.PageSessionCacheKey="AjaxSessionKey";this.ErrorLinePrefix="ErrorType=";this.ErrorCodeLinePrefix="ErrorCode=";this.PartnerErrorCodeLinePrefix="PartnerServiceErrorCode=";this.CorrelationIDPrefix="CorrelationID=";this.ErrorLineSuffix="\n";this.RequestAbortedError="RequestAborted";this.RequestAbortedErrorCode="RequestAbortedException";this.RequestTimedOutError="RequestTimedOut";this.RequestTimedOutErrorCode="RequestTimedOutException";this.OtherErrorCode="OtherException";this.RequestFailedError="RequestFailed";this.RequestFailedErrorCode="RequestFailedException";this.TraceDataPrefix="<BoxTrace>";this.TraceDataSuffix="<\/BoxTrace>";this.DiagnosticsTraceDataPrefix="<BoxDiagnosticsTrace>";this.DiagnosticsTraceDataSuffix="<\/BoxDiagnosticsTrace>";this.RegexTrace=new RegExp(this.TraceDataPrefix+"(.+)"+this.TraceDataSuffix,"gi");this.RegexDiagnosticsTrace=new RegExp(this.DiagnosticsTraceDataPrefix+"(.+)"+this.DiagnosticsTraceDataSuffix,"gi");this.MakeRequestGet=function(n,t,i){return this.MakeRequest(this.GetVerb,n,null,t,i)};this.MakeRequestPost=function(n,t,i,r){return this.MakeRequest(this.PostVerb,n,t,i,r)};this.MakeRequest=function(n,t,i,r,u,f,e){var s=Microsoft.Online.BOX.JS.Shared.GetSessionCookie(this.PageSessionCacheKey),o=new Sys.Net.WebRequest;return o.set_url(t),o.set_httpVerb(n),o.get_headers()[this.PageSessionCacheKey]=s,f!==undefined&&(o.get_headers()["Content-Type"]=f),n==this.PostVerb&&o.set_body(i),o.add_completed(function(n){var t=null;n.get_responseAvailable()&&n.get_statusCode()=="200"?(t=Microsoft.Online.BOX.JS.XmlHttpRequestService.ValidateResponse(n,e),t.ErrorCode!=null?u!=null&&u!=undefined?u(t):document.location=document.location.protocol+"//"+document.location.host+"/boxerror.aspx?"+Microsoft.Online.BOX.JS.XmlHttpRequestService.ErrorCodeLinePrefix+t.ErrorCode+"&"+Microsoft.Online.BOX.JS.XmlHttpRequestService.PartnerErrorCodeLinePrefix+t.PartnerErrorCode+"&"+Microsoft.Online.BOX.JS.XmlHttpRequestService.CorrelationIDPrefix+t.CorrelationID:r(t.Value)):(n.get_responseAvailable()&&(t=Microsoft.Online.BOX.JS.XmlHttpRequestService.ValidateResponse(n,e)),u==null||u==undefined?n.get_timedOut()?document.location=document.location.protocol+"//"+document.location.host+"/boxerror.aspx?"+Microsoft.Online.BOX.JS.XmlHttpRequestService.ErrorCodeLinePrefix+Microsoft.Online.BOX.JS.XmlHttpRequestService.RequestTimedOutErrorCode:n.get_aborted()||(document.location=document.location.protocol+"//"+document.location.host+"/boxerror.aspx?"+Microsoft.Online.BOX.JS.XmlHttpRequestService.ErrorCodeLinePrefix+Microsoft.Online.BOX.JS.XmlHttpRequestService.OtherErrorCode):n.get_timedOut()?(t==null&&(t=Microsoft.Online.BOX.JS.XmlHttpRequestService.ConstructTimeOutOrAbort(Microsoft.Online.BOX.JS.XmlHttpRequestService.RequestTimedOutErrorCode,Microsoft.Online.BOX.JS.XmlHttpRequestService.RequestTimedOutError)),u(t)):n.get_aborted()?(t==null&&(t=Microsoft.Online.BOX.JS.XmlHttpRequestService.ConstructTimeOutOrAbort(Microsoft.Online.BOX.JS.XmlHttpRequestService.RequestAbortedErrorCode,Microsoft.Online.BOX.JS.XmlHttpRequestService.RequestAbortedError)),u(t)):(t==null&&(t=Microsoft.Online.BOX.JS.XmlHttpRequestService.ConstructTimeOutOrAbort(Microsoft.Online.BOX.JS.XmlHttpRequestService.RequestFailedErrorCode,Microsoft.Online.BOX.JS.XmlHttpRequestService.RequestFailedError)),u(t)))}),o.invoke(),o};this.ConstructTimeOutOrAbort=function(n,t){var i={};return i.Value=null,i.ErrorType=t,i.ErrorCode=n,i.CorrelationID=null,i};this.ValidateResponse=function(n,t){var r=n.get_responseData(),i,u,o,s,l,f,a,e,v,h,c;return(t===undefined&&(t=!1),i={},i.Value=null,i.ErrorType=null,i.ErrorCode=null,i.PartnerErrorCode=0,i.CorrelationID=0,u=r.indexOf(this.ErrorLineSuffix),u==-1&&!t)?(i.ErrorType="Exception",i.ErrorCode="InvalidResponseFormat",i):(o=r.substring(0,u),t?(i.StatusCode=n.get_statusCode(),l=n.getResponseHeader("error"),s=l!="error"):s=o=="SessionValid",s?(i.Value=t?r:r.substring(u+1),i):o.indexOf(Microsoft.Online.BOX.JS.XmlHttpRequestService.ErrorLinePrefix)==0?(f=r.indexOf(this.ErrorCodeLinePrefix),a=r.indexOf(this.ErrorLineSuffix,f),i.ErrorCode=f!=-1?r.substring(f+this.ErrorCodeLinePrefix.length,a):"Unknown",e=r.indexOf(this.PartnerErrorCodeLinePrefix),v=r.indexOf(this.ErrorLineSuffix,e),i.PartnerErrorCode=e!=-1?r.substring(e+this.PartnerErrorCodeLinePrefix.length,v):"0",h=r.indexOf(this.ErrorLineSuffix,0),i.ErrorType=h!=-1?r.substring(this.ErrorLinePrefix.length,h):"Exception",c=r.indexOf(this.CorrelationIDPrefix),i.CorrelationID=c!=-1?r.substring(c+this.CorrelationIDPrefix.length):"0",i):(i.ErrorType="Exception",i.ErrorCode="InvalidResponseFormat",i.PartnerErrorCode="0",i))}};var XmlHttpRequestService=Microsoft.Online.BOX.JS.XmlHttpRequestService